/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JFrame.java to edit this template
 */
package com.mycompany.lab_isi.ii;

import java.awt.Dimension;
import java.util.*;
import javax.swing.JOptionPane;
import modelo.Camping;
import modelo.Cliente;
import modelo.Parcela;
import modelo.Reserva;
import modelo.ReservaDAO;

/**
 *
 * @author ramon
 */
public class Vista_5 extends javax.swing.JFrame {

    private Date f_ini;
    private Date f_fin;
    private Camping camping;
    private ArrayList<Parcela> parcelas;
    private Reserva reserva;
    private Cliente c;

    /**
     * Creates new form Ventana8
     */
    public Vista_5(Date f_ini, Date f_fin, Cliente c) {
        initComponents();
        this.c = c;
        this.f_ini = f_ini;
        this.f_fin = f_fin;
        camping = Camping.getInstancia();
        parcelas = camping.getParcelasDisponibles(f_ini, f_fin);
        System.out.println(parcelas);
        for (Parcela p : parcelas) {
            combobox_parcelas.addItem(p);
        }

    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        tfUsuario1 = new javax.swing.JTextField();
        tfContraseña3 = new javax.swing.JTextField();
        tfContraseña7 = new javax.swing.JTextField();
        jLabel4 = new javax.swing.JLabel();
        jbReservar = new javax.swing.JButton();
        jLabel1 = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        jLabel3 = new javax.swing.JLabel();
        jLabel5 = new javax.swing.JLabel();
        jLabel6 = new javax.swing.JLabel();
        l_m2 = new javax.swing.JLabel();
        l_id = new javax.swing.JLabel();
        l_luz = new javax.swing.JLabel();
        l_precio = new javax.swing.JLabel();
        jLabel12 = new javax.swing.JLabel();
        numeroTiendas = new javax.swing.JTextField();
        Atras_Vista5 = new javax.swing.JButton();
        combobox_parcelas = new javax.swing.JComboBox<>();

        tfContraseña3.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                tfContraseña3ActionPerformed(evt);
            }
        });

        tfContraseña7.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                tfContraseña7ActionPerformed(evt);
            }
        });

        jLabel4.setText("Metros cuadrados");

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);

        jbReservar.setBackground(new java.awt.Color(0, 51, 255));
        jbReservar.setForeground(new java.awt.Color(255, 255, 255));
        jbReservar.setText("Reservar");
        jbReservar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jbReservarActionPerformed(evt);
            }
        });

        jLabel1.setText("Luz");

        jLabel2.setText("ID");

        jLabel3.setText("Metros cuadrados");

        jLabel5.setText("Precio por dia");

        jLabel6.setText("Numero de tiendas");

        l_m2.setText("50");

        l_id.setText("5");

        l_luz.setText("Sí");

        l_precio.setText("20");

        jLabel12.setFont(new java.awt.Font("Segoe UI", 0, 18)); // NOI18N
        jLabel12.setText("PARCELAS DISPONIBLES");

        numeroTiendas.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                numeroTiendasActionPerformed(evt);
            }
        });

        Atras_Vista5.setBackground(new java.awt.Color(0, 51, 255));
        Atras_Vista5.setForeground(new java.awt.Color(255, 255, 255));
        Atras_Vista5.setText("Atrás");
        Atras_Vista5.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                Atras_Vista5ActionPerformed(evt);
            }
        });

        combobox_parcelas.addItemListener(new java.awt.event.ItemListener() {
            public void itemStateChanged(java.awt.event.ItemEvent evt) {
                combobox_parcelasItemStateChanged(evt);
            }
        });
        combobox_parcelas.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                combobox_parcelasActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addGap(34, 34, 34)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(jLabel2, javax.swing.GroupLayout.PREFERRED_SIZE, 37, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(l_id, javax.swing.GroupLayout.PREFERRED_SIZE, 49, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addComponent(jLabel3, javax.swing.GroupLayout.PREFERRED_SIZE, 104, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jLabel1, javax.swing.GroupLayout.PREFERRED_SIZE, 104, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jLabel5, javax.swing.GroupLayout.PREFERRED_SIZE, 104, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jLabel6, javax.swing.GroupLayout.PREFERRED_SIZE, 104, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(Atras_Vista5))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addComponent(l_precio, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, 49, Short.MAX_VALUE)
                            .addComponent(l_luz, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, 49, Short.MAX_VALUE)
                            .addComponent(l_m2, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(numeroTiendas, javax.swing.GroupLayout.PREFERRED_SIZE, 39, javax.swing.GroupLayout.PREFERRED_SIZE))))
                .addGap(64, 64, 64))
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(jbReservar)
                .addGap(114, 114, 114))
            .addGroup(layout.createSequentialGroup()
                .addGap(63, 63, 63)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(combobox_parcelas, javax.swing.GroupLayout.PREFERRED_SIZE, 214, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel12, javax.swing.GroupLayout.PREFERRED_SIZE, 225, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap(82, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGap(13, 13, 13)
                .addComponent(jLabel12, javax.swing.GroupLayout.DEFAULT_SIZE, 28, Short.MAX_VALUE)
                .addGap(18, 18, 18)
                .addComponent(combobox_parcelas, javax.swing.GroupLayout.PREFERRED_SIZE, 64, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(28, 28, 28)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel2)
                    .addComponent(l_id))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel3)
                    .addComponent(l_m2))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel1)
                    .addComponent(l_luz))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel5)
                    .addComponent(l_precio))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel6)
                    .addComponent(numeroTiendas, javax.swing.GroupLayout.PREFERRED_SIZE, 22, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(9, 9, 9)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jbReservar)
                    .addComponent(Atras_Vista5))
                .addContainerGap())
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void jbReservarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jbReservarActionPerformed
        Parcela p = (Parcela) combobox_parcelas.getSelectedItem();
        int metros=0;
        boolean valido=true;

        for (int i = 0; i < Integer.parseInt(numeroTiendas.getText()); i++) {
            String input = JOptionPane.showInputDialog(null, "Introduce los metros de la tienda " + (i + 1) + ":");
            if (input != null && !input.isEmpty()) {
                try {
                    metros+=Integer.parseInt(input);
                } catch (NumberFormatException e) {
                    JOptionPane.showMessageDialog(null, "No es un número válido. Inténtalo de nuevo.", "Error", JOptionPane.ERROR_MESSAGE);
                    valido=false;
                    i--; // Decrementa i para repetir este paso del bucle
                }
            } else {
                JOptionPane.showMessageDialog(null, "Operación cancelada.");
                valido=false;
                break; // Salir del bucle si el usuario cancela
            }
        }

        if(metros<=p.getm2()&&valido)
        {
            JOptionPane.showMessageDialog(null, "Reserva valida.");
            reserva = new Reserva(Camping.generarIdReserva(), f_ini, f_fin, c, p);
            Camping.anyadirReserva(reserva);
            c.AgregaReserva(reserva);
            ReservaDAO dao = new ReservaDAO();
            dao.crearReserva(reserva);
        }
        else
        {
            JOptionPane.showMessageDialog(null, "Reserva no valida.");
        }
        numeroTiendas.setText("");
        combobox_parcelas.removeAllItems();
        ArrayList<Parcela> recargar = camping.getParcelasDisponibles(f_ini, f_fin);
        System.out.println(Camping.getParcelas());
        System.out.println(parcelas);
        for (Parcela r : recargar) {
            combobox_parcelas.addItem(r);
        }
        

    }//GEN-LAST:event_jbReservarActionPerformed

    private void tfContraseña3ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_tfContraseña3ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_tfContraseña3ActionPerformed

    private void tfContraseña7ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_tfContraseña7ActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_tfContraseña7ActionPerformed

    private void Atras_Vista5ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_Atras_Vista5ActionPerformed
        // TODO add your handling code here:
        Vista_3 v3 = new Vista_3(c);
        v3.show();
        this.dispose();
    }//GEN-LAST:event_Atras_Vista5ActionPerformed

    private void numeroTiendasActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_numeroTiendasActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_numeroTiendasActionPerformed

    private void combobox_parcelasItemStateChanged(java.awt.event.ItemEvent evt) {//GEN-FIRST:event_combobox_parcelasItemStateChanged
        
        Parcela p = (Parcela) combobox_parcelas.getSelectedItem();
        if(p!=null){
        l_id.setText(p.getId() + "");
        if (p.getLuz()) {
            l_luz.setText("Si");
        } else {
            l_luz.setText("No");
        }
        l_m2.setText(p.getm2() + "");
        l_precio.setText(p.getPrecio() + "");}
    }//GEN-LAST:event_combobox_parcelasItemStateChanged

    private void combobox_parcelasActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_combobox_parcelasActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_combobox_parcelasActionPerformed

    /**
     * @param args the command line arguments
     */

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton Atras_Vista5;
    private javax.swing.JComboBox<Parcela> combobox_parcelas;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel12;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JButton jbReservar;
    private javax.swing.JLabel l_id;
    private javax.swing.JLabel l_luz;
    private javax.swing.JLabel l_m2;
    private javax.swing.JLabel l_precio;
    private javax.swing.JTextField numeroTiendas;
    private javax.swing.JTextField tfContraseña3;
    private javax.swing.JTextField tfContraseña7;
    private javax.swing.JTextField tfUsuario1;
    // End of variables declaration//GEN-END:variables
}
